node {
    stage ('Checkout'){
        git branch: 'build-first-jenkins-build', url: 'https://github.com/zloof/morse.git'
    }
    stage ('pull'){
        // login to AWS-ECR and pull the docker image
        docker.withRegistry('https://138858731413.dkr.ecr.us-east-1.amazonaws.com', 'ecr:us-east-1:demo-ecr-credentials') {
            docker.image('zloof/morse').pull()
        }
    }
    stage ('test'){
        // RUN the server in the background
        sh "docker-compose -f docker-compose-test.yml up -d server"
        sh "docker-compose -f docker-compose-test.yml build"
        sh "docker-compose -f docker-compose-test.yml up client"
        sh "docker-compose -f docker-compose-test.yml down"
    }
}
