node {
    stage ('Checkout'){
        checkout scm
    }
    stage ('Build'){
        echo "Build step"
        sh "docker build -t zloof/morse --target server ."
    }
    stage ('Test'){
        echo "Test step"
    }
    stage ('Push'){
        // login to AWS-ECR and push the docker image
        docker.withRegistry('https://138858731413.dkr.ecr.us-east-1.amazonaws.com', 'ecr:us-east-1:demo-ecr-credentials') {
            docker.image('zloof/morse').push('latest')
        }
    }
}
